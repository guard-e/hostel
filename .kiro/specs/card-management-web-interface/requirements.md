# Документ требований: Веб-интерфейс управления картами

## Введение

Веб-приложение для управления картами (пропусками) предоставляет пользователям возможность выполнять операции создания, редактирования и удаления карт через веб-интерфейс. Система взаимодействует с базой данных Firebird (guardee.fdb) через хранимую процедуру HOSTEL_CARDEDIT и построена на технологическом стеке Flask, SQLAlchemy, Bootstrap 5.

## Глоссарий

- **Система**: Веб-приложение управления картами
- **Карта**: Электронный пропуск, хранящийся в базе данных
- **Пользователь**: Лицо, взаимодействующее с веб-интерфейсом
- **HOSTEL_CARDEDIT**: Хранимая процедура в базе данных для операций с картами
- **База_Данных**: База данных Firebird guardee.fdb
- **Веб_Интерфейс**: Пользовательский интерфейс на основе HTML, CSS, JavaScript, Bootstrap 5
- **Backend**: Серверная часть приложения на Flask и SQLAlchemy
- **Форма_Карты**: Веб-форма для ввода и редактирования данных карты

## Требования

### Требование 1: Добавление новых карт

**Пользовательская история:** Как пользователь, я хочу добавлять новые карты в систему, чтобы регистрировать новые пропуска.

#### Критерии приемки

1. КОГДА пользователь заполняет Форму_Карты валидными данными и отправляет форму, Система ДОЛЖНА создать новую запись карты в Базе_Данных через процедуру HOSTEL_CARDEDIT
2. КОГДА пользователь пытается добавить карту с пустыми обязательными полями, Система ДОЛЖНА отклонить операцию и отобразить сообщение об ошибке валидации
3. КОГДА новая карта успешно добавлена, Система ДОЛЖНА отобразить подтверждающее сообщение и обновить список карт
4. КОГДА операция добавления карты завершается, Система ДОЛЖНА очистить Форму_Карты для следующего ввода

### Требование 2: Редактирование существующих карт

**Пользовательская история:** Как пользователь, я хочу редактировать существующие карты, чтобы обновлять информацию о пропусках.

#### Критерии приемки

1. КОГДА пользователь выбирает карту для редактирования, Система ДОЛЖНА загрузить данные карты из Базы_Данных и заполнить Форму_Карты
2. КОГДА пользователь изменяет данные карты и сохраняет изменения, Система ДОЛЖНА обновить запись в Базе_Данных через процедуру HOSTEL_CARDEDIT
3. КОГДА редактирование карты завершается успешно, Система ДОЛЖНА отобразить подтверждающее сообщение и обновить отображаемые данные
4. ЕСЛИ во время редактирования происходит ошибка базы данных, Система ДОЛЖНА отобразить сообщение об ошибке и сохранить введенные данные в форме

### Требование 3: Удаление карт

**Пользовательская история:** Как пользователь, я хочу удалять карты из системы, чтобы убирать недействительные или устаревшие пропуска.

#### Критерии приемки

1. КОГДА пользователь инициирует удаление карты, Система ДОЛЖНА запросить подтверждение операции
2. КОГДА пользователь подтверждает удаление, Система ДОЛЖНА удалить запись карты из Базы_Данных через процедуру HOSTEL_CARDEDIT
3. КОГДА удаление завершается успешно, Система ДОЛЖНА отобразить подтверждающее сообщение и обновить список карт
4. ЕСЛИ удаление отменяется пользователем, Система ДОЛЖНА сохранить карту без изменений

### Требование 4: Отображение списка карт

**Пользовательская история:** Как пользователь, я хочу просматривать список всех карт, чтобы видеть существующие пропуска.

#### Критерии приемки

1. КОГДА пользователь открывает главную страницу, Система ДОЛЖНА отобразить список всех карт из Базы_Данных
2. КОГДА список карт отображается, Система ДОЛЖНА показывать ключевые атрибуты каждой карты в табличном формате
3. Система ДОЛЖНА предоставить элементы управления для редактирования и удаления каждой карты в списке
4. КОГДА данные в Базе_Данных изменяются, Система ДОЛЖНА обновить отображаемый список карт

### Требование 5: Взаимодействие с базой данных через процедуру

**Пользовательская история:** Как система, я должна взаимодействовать с базой данных через установленную процедуру, чтобы обеспечить целостность данных.

#### Критерии приемки

1. Система ДОЛЖНА выполнять все операции создания, обновления и удаления карт через процедуру HOSTEL_CARDEDIT
2. КОГДА вызывается процедура HOSTEL_CARDEDIT, Система ДОЛЖНА передавать корректные параметры в соответствии с типом операции
3. КОГДА процедура HOSTEL_CARDEDIT возвращает ошибку, Система ДОЛЖНА обработать ошибку и отобразить понятное сообщение пользователю
4. Система ДОЛЖНА использовать SQLAlchemy для управления соединениями с Базой_Данных Firebird

### Требование 6: Валидация данных

**Пользовательская история:** Как система, я должна валидировать вводимые данные, чтобы предотвратить некорректные записи в базе данных.

#### Критерии приемки

1. КОГДА пользователь вводит данные в Форму_Карты, Система ДОЛЖНА выполнять валидацию на стороне клиента с использованием JavaScript
2. КОГДА форма отправляется на сервер, Backend ДОЛЖЕН выполнять повторную валидацию всех данных
3. ЕСЛИ данные не проходят валидацию, Система ДОЛЖНА отобразить конкретные сообщения об ошибках рядом с соответствующими полями
4. Система ДОЛЖНА предотвращать отправку формы с невалидными данными

### Требование 7: Пользовательский интерфейс

**Пользовательская история:** Как пользователь, я хочу использовать интуитивный и отзывчивый интерфейс, чтобы эффективно управлять картами.

#### Критерии приемки

1. Система ДОЛЖНА использовать Bootstrap 5 для создания отзывчивого дизайна, адаптирующегося к различным размерам экрана
2. КОГДА пользователь взаимодействует с элементами интерфейса, Система ДОЛЖНА предоставлять визуальную обратную связь
3. Веб_Интерфейс ДОЛЖЕН отображать формы, таблицы и кнопки в соответствии с принципами UX
4. КОГДА выполняются длительные операции, Система ДОЛЖНА отображать индикатор загрузки

### Требование 8: Обработка ошибок

**Пользовательская история:** Как пользователь, я хочу получать понятные сообщения об ошибках, чтобы понимать, что пошло не так.

#### Критерии приемки

1. ЕСЛИ происходит ошибка соединения с Базой_Данных, Система ДОЛЖНА отобразить сообщение о проблеме подключения
2. ЕСЛИ процедура HOSTEL_CARDEDIT возвращает ошибку, Система ДОЛЖНА отобразить описание ошибки пользователю
3. КОГДА происходит непредвиденная ошибка, Система ДОЛЖНА отобразить общее сообщение об ошибке и записать детали в лог
4. Система ДОЛЖНА предотвращать отображение технических деталей ошибок конечному пользователю

### Требование 9: Аутентификация пользователей

**Пользовательская история:** Как администратор, я хочу защитить доступ к приложению паролем, чтобы только авторизованные пользователи могли управлять картами.

#### Критерии приемки

1. КОГДА неавторизованный пользователь открывает приложение, Система ДОЛЖНА отобразить только страницу выбора файла базы данных guardee.fdb
2. КОГДА пользователь выбирает файл базы данных, Система ДОЛЖНА отобразить форму входа с полями для имени пользователя и пароля
3. КОГДА пользователь вводит имя и пароль, Система ДОЛЖНА прочитать таблицу USERS из выбранной Базы_Данных
4. Система ДОЛЖНА найти запись в таблице USERS с полем NAME, совпадающим с введенным именем пользователя
5. ЕСЛИ запись найдена, Система ДОЛЖНА проверить пароль и проанализировать поля FLAGS и SFLAGS для определения прав доступа
6. ЕСЛИ аутентификация успешна, Система ДОЛЖНА создать сессию пользователя и предоставить доступ к функциям управления картами
7. ЕСЛИ аутентификация не удалась, Система ДОЛЖНА отобразить сообщение об ошибке и не предоставлять доступ к приложению
8. Система ДОЛЖНА хранить информацию о сессии пользователя и проверять авторизацию при каждом запросе к защищенным страницам

### Требование 10: Настройка подключения к базе данных

**Пользовательская история:** Как пользователь, я хочу настраивать параметры подключения к базе данных Firebird через веб-интерфейс, чтобы подключаться к разным базам данных без изменения кода.

#### Критерии приемки

1. Система ДОЛЖНА предоставить страницу настроек с формой для ввода параметров подключения к Базе_Данных Firebird
2. КОГДА пользователь заполняет форму настроек, Система ДОЛЖНА запрашивать следующие параметры: хост, порт, путь к файлу базы данных, имя пользователя, пароль
3. КОГДА пользователь сохраняет настройки подключения, Система ДОЛЖНА проверить возможность подключения к указанной Базе_Данных
4. ЕСЛИ подключение успешно, Система ДОЛЖНА сохранить параметры и отобразить подтверждающее сообщение
5. ЕСЛИ подключение не удалось, Система ДОЛЖНА отобразить сообщение об ошибке с описанием проблемы
6. Система ДОЛЖНА хранить параметры подключения в защищенном виде (пароль должен быть зашифрован)
7. КОГДА приложение запускается, Система ДОЛЖНА использовать сохраненные параметры подключения для работы с Базой_Данных

### Требование 10: Настройка подключения к базе данных

**Пользовательская история:** Как пользователь, я хочу выбирать файл базы данных Firebird через веб-интерфейс, чтобы подключаться к нужной базе данных.

#### Критерии приемки

1. Система ДОЛЖНА предоставить страницу выбора файла базы данных guardee.fdb как первую страницу для неавторизованных пользователей
2. КОГДА пользователь выбирает файл базы данных, Система ДОЛЖНА сохранить путь к файлу для текущей сессии
3. КОГДА файл базы данных выбран, Система ДОЛЖНА проверить возможность подключения к указанной Базе_Данных
4. ЕСЛИ подключение успешно, Система ДОЛЖНА перейти к странице аутентификации
5. ЕСЛИ подключение не удалось, Система ДОЛЖНА отобразить сообщение об ошибке и позволить выбрать другой файл
6. Система ДОЛЖНА хранить параметры подключения (хост, порт, путь к файлу) в защищенном виде для текущей сессии

### Требование 11: Архитектура приложения

**Пользовательская история:** Как разработчик, я хочу иметь четкое разделение между слоями приложения, чтобы система была поддерживаемой и расширяемой.

#### Критерии приемки

1. Backend ДОЛЖЕН быть реализован с использованием Flask и следовать паттерну MVC
2. Система ДОЛЖНА использовать SQLAlchemy для абстракции работы с Базой_Данных
3. Frontend ДОЛЖЕН использовать Bootstrap 5 для стилизации и компоновки
4. КОГДА изменяется логика работы с данными, изменения ДОЛЖНЫ быть изолированы в слое Backend без влияния на Frontend
